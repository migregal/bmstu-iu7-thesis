\chapter{Технологический раздел}

\section{Средства реализации}

\subsection*{Выбор языка программирования}

Для реализации программного комплекса будет использоваться язык программирования Python~3~\cite{python3}. Данный выбор обусловлен следующими факторами:
\begin{itemize}[label=---]
    \item широкий набор библиотек для работы с нейронными сетями;
    \item возможность обучать нейронную сеть на графическом процессоре с
использованием технологии CUDA~\cite{cuda}.
\end{itemize}

Кроме того, как указывалось ранее, для выбранного языка программирования уже существуют общедоступные пакеты для работы с выбранным методом обнаружения, включая методы для обучения, тестирования и валидации работы метода.

\subsection*{Выбор библиотеки глубокого обучения}

Для создания и обучения модели нейронной сети была выбрана библиотека PyTorch~\cite{pytorch} версии 2.0.0. Выбор данной версии обусловлен поддержкой CUDA 11.8, предоставляемой GPU NVIDIA GeForce RTX 2060~\cite{rtx2060}, на котором будет производиться обучение нейронной сети.

\section{Реализация программного комплекса}

\subsection{Модуль метода распознавания}

Реализация модуля построена на YOLOv8n модели. Модуль состоит из трех слабых экспертов, обученных с использованием различных наборов данных, как было описано ранее.

В связи с тем, что данные слабые эксперты не зависят от результатов работы друг друга, присутствует возможность распараллеливания процесса обработки изображения слабыми экспертами с целью снижения времени отклика системы.

Для организации параллельной обработки будет использован Ray --- фреймворк с открытым исходным кодом, предоставляющий возможность параллельного выполнения, а так же кластеризации различного рода вычислений, в том числе при использовании нейронных сетей~\cite{pkg-ray}.

В дополнение к вышесказанному, Ray предоставляет возможность управления ресурсами, использующимися в процессе вычислений в кластере, а так же отслеживает доступные на каждом из узлов кластера ресурсы, с целью оптимищзации процесса вычислений.

В листингах~\ref{lst:detect.py}~и~\ref{lst:detect.1.py} приведена реализация модуля модели, отвечающего за обнаружение надводных объектов.


\subsection{Обучение слабых экспертов}

В предоставляемом Ultralytics пакете для работы с YOLOv8 предусмотрены методы для обучения моделей с различными параметрами и возможностью применения таких оптимизаций, как батчинг изображений, мозаичная аугментация на ранних стадиях обучения, отслеживание результатов процесса обучения с прерыванием в случае простоя и прочие~\cite{pkg-ultralytics}.

На рисунках~\ref{img:train_batch1}~и~\ref{img:train_batch2} представлены примеры использования описанных выше оптимизаций в процессе обучения.

\includeimage{train_batch1}{f}{h}{0.45\textwidth}{Батч обучающей выборки с применением мозаичной аугментации. Часть 1}

\includeimage{train_batch2}{f}{h}{0.45\textwidth}{Батч обучающей выборки с применением мозаичной аугментации. Часть 2}

Помимо этого, указанный выше пакет предоставляет средства для автоматической предобработки изображения (его масштабирования) при превышении размера, использованного при обучении модели. В совокупности с использованием нормализованных координат при формаировании результатов распознавания, это позволяет полностью переложить процесс предобработки на описанный выше пакет.

На рисунке~\ref{img:val_batch1_pred} представлен пример использования описанных выше оптимизаций в процессе валидации результатов работы обученной модели.

\includeimage{val_batch1_pred}{f}{h}{0.5\textwidth}{Батч валидационной выборки}

\section{Результаты обучения слабых экспертов}

\subsection*{Kaggle Ships In Google Earth}

Процесс обучения состоял из 100~эпох, при этому можно отметить, что точность распознавания возрастала на протяжении всего процесса обучения и достигла 92~\%. Отдельно стоит отметить, что начиная с 30~эпохи точности составляла более 80~\%.

\includelisting{train_1.txt}{Результат обучения слабого эксперта}

\begin{figure}[htp]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			axis lines=left,
			legend pos=south east,
			ymajorgrids=true,
			xmajorgrids=true,
			xtick={10,20,30,40,50,60,70,80,90,100},
			xlabel={Эпоха, ед.},
		]
			\addplot table[x=epoch,y=metrics/precision(B),col sep=comma] {inc/csv/train_1.csv};
			\addplot table[x=epoch,y=metrics/recall(B),col sep=comma] {inc/csv/train_1.csv};
			\legend{Точность, Полнота}
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption{Точность (P) и полнота (R) слабых экспертов. Часть 1}
	\label{plt:precision}
\end{figure}

\subsection*{ShipRSImageNet}

Аналогично предыдущему слабому эксперту, обучение производилось в течение 100~эпох. В процессе обучения точность достигла 85~\%. При этом, точность в 60~\% была достигнута лишь к 40 эпохе.

Различия в кривых обучения в сравнении с предыдущим набором данных можно объяснить различиями в точности разметки данных в различных наборах.

\includelisting{train_2.txt}{Результат обучения слабого эксперта}

\begin{figure}[htp]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			axis lines=left,
			xlabel={Эпоха, ед.},
			ylabel={P},
			legend pos=south east,
			ymajorgrids=true,
			xmajorgrids=true,
			xtick={10,20,30,40,50,60,70,80,90,100},
		]
			\addplot table[x=epoch,y=metrics/precision(B),col sep=comma] {inc/csv/train_2.csv};
			\addplot table[x=epoch,y=metrics/recall(B),col sep=comma] {inc/csv/train_2.csv};
            \legend{Точность, Полнота}
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption{Точность (P) и полнота (R) слабых экспертов. Часть 2}
	\label{plt:precision_2}
\end{figure}

\subsection*{Huawei Ship}

В процессе обучения с использованием данного набора данных, модель завершила обучение на 15ой эпохе. Данный факт был установлен экспериментально --- в течение 50-ти эпох после этого не было отмечено значительных изменений в точности обнаружения обхъектов.

По итогам обучения, точности достигла 83~\%, при этом уже с первой эпохи точность работы метода составляла не менее 75~\%.

\includelisting{train_3.txt}{Результат обучения слабого эксперта}

\begin{figure}[htp]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			axis lines=left,
			xlabel={Эпоха, ед.},
			ylabel={P},
			legend pos=south east,
			ymajorgrids=true,
			xmajorgrids=true,
		]
			\addplot table[x=epoch,y=metrics/precision(B),col sep=comma] {inc/csv/train_3.csv};
			\addplot table[x=epoch,y=metrics/recall(B),col sep=comma] {inc/csv/train_3.csv};
			\legend{Точность, Полнота}
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption{Точность (P) и полнота (R) слабых экспертов. Часть 3}
	\label{plt:precision_3}
\end{figure}

\section{Примеры использования разработанного программного комплекса}

Модуль, реализующий метод распознавания объектов с использованием модели YOLOv8 выполнен в виде пакета на языке Python~3 и не предоставляет пользовательского интерфейса для работы с ним, в связи с чем не может быть продемонстрировано непосредственное использование данного модуля.

В то же время, модуль пользовательского приложения представляет собой консольное приложение без графического интерфейса. Конфигурация производится посредством изменения аргументов командной строки.

\subsection{Пример обучения модели}

\includelisting{train_help.txt}{Взаимодействие с пользовательским приложением обучения модели}

\includelisting{train_usage.txt}{Запуск обучения модели}

\subsection{Пример распознавания объектов}

\includelisting{cli_help.txt}{Взаимодействие с пользовательским приложением распознавания объектов}

\includelisting{cli_usage.txt}{Запуск приложения}

\section{Вывод}

Были приведены выбор и обоснование выбора программных средств реализации предложенного метода.

Описать формат входных и выходных данных.

Была описана разработка программного обеспечения, реализующего разработанный метод, а именно: описаны процессы реализации модулей программного комплекса и обучения слабых экспертов (моделей нейронной сети). Были приведены результаты обучкения моделей. В дополнение к этому были приведены примеры использования разработанного программного обеспечения.
